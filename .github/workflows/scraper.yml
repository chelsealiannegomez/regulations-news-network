name: Scraper Pipeline

on:
    schedule:
        - cron: "0 7 * * *"
    workflow_dispatch:
    push:

permissions:
    contents: write

jobs:
    scrape:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v3
              with:
                  persist-credentials: true

            - name: Set up Python
              uses: actions/setup-python@v4
              with:
                  python-version: "3.10"

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install -r requirements.txt

            - name: Run Scraper Pipeline
              env:
                  PGHOST: ${{ secrets.PGHOST }}
                  PGUSER: ${{ secrets.PGUSER }}
                  PGDATABASE: ${{ secrets.PGDATABASE }}
                  PGPASSWORD: ${{ secrets.PGPASSWORD }}
              run: |
                  cd python_scripts/scraper_pipeline
                  python3 pipeline.py
